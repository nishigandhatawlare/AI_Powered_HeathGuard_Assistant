@{
    Layout = "_Layout";
    ViewData["Title"] = "Medication Management";
}

<!-- Main Section -->
<div class="main container my-5">

    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <h1>Medication Management</h1>
        </div>
        <div class="col text-end">
            @if (User.IsInRole("ADMIN") || User.IsInRole("DOCTOR"))
            {
                <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addMedicationModal">Add Medication</a>
            }
        </div>
    </div>

    <!-- Content Area -->
    <div class="content-area row">
        <!-- Medications List -->
        <div class="col-md-4 mb-4">
            <div class="medication-card card shadow border-light">
                <div class="card-body">
                    <h5 class="card-title">Medication Name 1</h5>
                    <p class="card-text dosage">Dosage: <strong>500mg</strong></p>
                    <p class="card-text timing"><i class="fa fa-clock"></i> <strong>Timing:</strong> Twice a day</p>
                    <div class="actions d-flex justify-content-between mt-3">
                        @if (User.IsInRole("ADMIN") || User.IsInRole("DOCTOR"))
                        {
                            <a href="#" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editMedicationModal" data-id="1">Edit</a>
                            <a href="#" class="btn btn-danger btn-sm remove-btn" data-id="1" data-bs-toggle="modal" data-bs-target="#confirmRemoveModal">Remove</a>
                        }
                        <i class="fa fa-exclamation-circle text-warning" title="Interaction Warning"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Repeat the above block for additional medications... -->

    </div>

    <!-- Modal for Adding Medication -->
    <div class="modal fade" id="addMedicationModal" tabindex="-1" aria-labelledby="addMedicationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addMedicationModalLabel">Add Medication</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addMedicationForm">
                        <div class="mb-3">
                            <label for="medicationName" class="form-label">Medication Name</label>
                            <input type="text" class="form-control" id="medicationName" required>
                        </div>
                        <div class="mb-3">
                            <label for="dosage" class="form-label">Dosage</label>
                            <input type="text" class="form-control" id="dosage" required>
                        </div>
                        <div class="mb-3">
                            <label for="timing" class="form-label">Timing</label>
                            <input type="text" class="form-control" id="timing" required>
                        </div>
                        <div class="mb-3">
                            <label for="interactionWarning" class="form-label">Interaction Warning</label>
                            <select class="form-select" id="interactionWarning">
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" id="addMedicationButton">Add Medication</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal for Removing Medication -->
    <div class="modal fade" id="confirmRemoveModal" tabindex="-1" aria-labelledby="confirmRemoveModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmRemoveModalLabel">Confirm Removal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to remove this medication?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmRemoveButton">Remove</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Editing Medication -->
    <div class="modal fade" id="editMedicationModal" tabindex="-1" aria-labelledby="editMedicationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editMedicationModalLabel">Edit Medication</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editMedicationForm">
                        <input type="hidden" id="editMedicationId" />
                        <div class="mb-3">
                            <label for="editMedicationName" class="form-label">Medication Name</label>
                            <input type="text" class="form-control" id="editMedicationName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editDosage" class="form-label">Dosage</label>
                            <input type="text" class="form-control" id="editDosage" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTiming" class="form-label">Timing</label>
                            <input type="text" class="form-control" id="editTiming" required>
                        </div>
                        <div class="mb-3">
                            <label for="editInteractionWarning" class="form-label">Interaction Warning</label>
                            <select class="form-select" id="editInteractionWarning">
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" id="editMedicationButton">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

</div>

@section Scripts {
    <script>
        // Confirm Remove Button click event
        document.querySelectorAll('.remove-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const medicationId = this.getAttribute('data-id');
                const confirmRemoveButton = document.getElementById('confirmRemoveButton');

                // Set an event listener for the confirm remove button
                confirmRemoveButton.onclick = function () {
                    // Add logic to remove the medication by ID
                    console.log(`Removing medication with ID: ${medicationId}`);
                    // Close the modal
                    $('#confirmRemoveModal').modal('hide');
                };
            });
        });
    </script>
}
